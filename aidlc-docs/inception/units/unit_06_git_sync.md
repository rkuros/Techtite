# Unit 6: Git統合・透過的同期

> **対応 Epic**: Epic 5 — Git統合・透過的同期
> **対応ストーリー**: US-5.1〜US-5.12

---

## ユーザーストーリーと受け入れ基準

### US-5.1 [Must] Gitリポジトリ自動認識

個人開発者として、プロジェクトフォルダ内のGitリポジトリを自動的に認識してほしい。なぜなら、コードとドキュメントが同じリポジトリにあることを前提に作業したいからだ。

- [ ] Vault内に`.git`ディレクトリがある場合、自動的にGitリポジトリとして認識される
- [ ] ステータスバーに現在のブランチ名が表示される
- [ ] Gitリポジトリが存在しない場合は、Git機能が無効化される

### US-5.2 [Must] 変更差分表示

個人開発者として、ファイルの変更差分をアプリ内で確認したい。なぜなら、コミット前にどのような変更を行ったかを確認したいからだ。

- [ ] 変更のあるファイルの一覧が表示される（staged / unstaged / untracked）
- [ ] ファイルを選択すると追加・削除・変更行が色分け表示される

### US-5.3 [Must] コミット作成

個人開発者として、アプリ内からコミットメッセージを入力してコミットを作成したい。なぜなら、コードとドキュメントの変更を一つのコミットとしてまとめて記録したいからだ。

- [ ] ファイルのステージ（add）操作ができる
- [ ] コミットメッセージを入力してコミットを実行できる
- [ ] コミット成功後、変更ファイル一覧がリセットされる

### US-5.4 [Should] コミット履歴閲覧

個人開発者として、コミット履歴を閲覧したい。なぜなら、プロジェクトの変更履歴を振り返り、いつどのような変更があったかを追跡したいからだ。

- [ ] コミット履歴がリスト形式で表示される（メッセージ、作者、日時）
- [ ] コミットを選択すると、そのコミットの変更ファイル・差分が表示される

### US-5.5 [Should] 自動ブランチ管理・マージ

個人開発者として、ブランチの作成・切り替え・マージがバックグラウンドで自動的に管理されてほしい。なぜなら、Gitの複雑な操作を意識せず、普通のアプリのように使いたいからだ。

- [ ] 必要に応じてブランチが自動作成される（エージェントまたはシステムによる）
- [ ] マージが自動で実行される
- [ ] マージ競合が発生した場合にユーザーに通知され、エージェントが自動解決を試みる
- [ ] 開発者向けオプションとして、手動でのブランチ操作も可能

### US-5.6 [Should] .gitignore表示制御

個人開発者として、.gitignoreに基づいてファイルエクスプローラの表示を制御したい。なぜなら、ビルド成果物やnode_modules等の不要なファイルをプロジェクト表示から除外したいからだ。

- [ ] .gitignoreに記載されたパターンに一致するファイル・フォルダがエクスプローラから非表示になる
- [ ] .gitignoreパターンが全文検索（US-4.7）のインデックス対象から除外される
- [ ] .gitignoreパターンがベクトルインデックス（US-4.12）の対象から除外される
- [ ] .gitignoreパターンがAIエージェントのファイル一覧取得（US-3.5）から除外される
- [ ] 非表示/表示の切り替えオプションがある（システム全体で一括、または機能別に個別設定可能）
- [ ] Techtiteが生成するローカル専用データ（生ログ、操作ログ、ベクトルインデックス）が.gitignoreに自動登録される

### US-5.7 [Must] AIからGit操作

AIエージェントとして、Gitの操作（コミット、差分確認等）をプログラム的に実行したい。なぜなら、コードとドキュメントの変更を自動的にバージョン管理したいからだ。

- [ ] API経由でステージ・コミット・差分取得が実行できる
- [ ] API経由でブランチ一覧・現在のブランチを取得できる

### US-5.8 [Must] リモートリポジトリ設定・接続

個人開発者として、リモートリポジトリ（GitHub等）への接続を簡単に設定したい。なぜなら、一度設定すれば自動同期が始まる仕組みにしたいからだ。

- [ ] 設定画面でリモートリポジトリURL・認証情報を設定できる
- [ ] Personal Access Token（PAT）またはSSHキーによる認証設定ができる
- [ ] 接続テスト（疎通確認）ができる
- [ ] 設定完了後、自動同期が即座に有効になる
- [ ] （拡張）GitHub/GitLab等のOAuth認証でワンクリック設定ができる

### US-5.9 [Must] バックグラウンド自動同期（push/pull）

個人開発者として、ファイルの変更がバックグラウンドでリモートリポジトリに自動同期されてほしい。なぜなら、Gitの操作を意識せず、普通のアプリのクラウド同期のように使いたいからだ。

- [ ] 一定時間窓（デフォルト: 5分）内の変更をバッチで1コミットにまとめ、バックグラウンドでcommit + pushが実行される
- [ ] コミットメッセージはAIがローカルで変更内容から自動生成する（例:「docs: セッションログ追加, fix: 認証モジュール修正」）。**差分・変更内容は外部LLM/外部サービスに送信しない（オンデバイス生成 or テンプレートフォールバック）**
- [ ] アプリ起動時にリモートの変更が自動的にpullされる
- [ ] 同期のタイミング（時間窓の長さ/手動のみ）を設定で選択できる
- [ ] 手動コミット（US-5.3）との併用が可能。手動コミットが行われた場合、その時点で自動バッチはリセットされる
- [ ] 自動コミットと手動コミットが履歴上で区別できる（自動コミットにはラベル/プレフィックス付与）

### US-5.10 [Must] 同期状態表示

個人開発者として、同期の状態をステータスバーで確認したい。なぜなら、データが最新の状態に保たれているか安心して作業したいからだ。

- [ ] ステータスバーに同期状態アイコンが表示される（同期中/完了/エラー）
- [ ] 最終同期日時が表示される
- [ ] エラーが発生した場合にエラー詳細を確認できる
- [ ] 手動で「今すぐ同期」ボタンを押して即座に同期を実行できる

### US-5.11 [Must] 競合の検知・通知・手動解決

個人開発者として、同期の競合が発生した場合に通知を受け、簡単な操作で解決したい。なぜなら、Gitのマージ競合を自分で解決する知識がなくても安心して使いたいからだ。

- [ ] ローカルとリモートの変更が競合した場合に、ユーザーに通知される
- [ ] 「ローカル優先/リモート優先」の選択肢がシンプルなUIで提示される
- [ ] 「AIに相談する」ボタンで、エージェントに競合内容の解説と解決提案を求められる
- [ ] バイナリファイルの競合は自動検出され、選択肢（どちらを採用するか）が提示される
- [ ] 競合解決の履歴がログとして保存される

### US-5.12 [Should] 競合のAI自動解決

個人開発者として、同期の競合がエージェントにより自動解決されてほしい。なぜなら、競合のたびに手動で対応するのは煩雑だからだ。

- [ ] テキストファイルの競合に対し、エージェントがコンテキストを理解した上で自動マージを試みる
- [ ] 自動解決できた場合はユーザーに通知のみ表示される（変更内容の差分確認リンク付き）
- [ ] 自動解決の信頼度が低い場合は、手動確認を促す（US-5.11にフォールバック）
- [ ] 大量の競合が同時発生した場合の処理上限（バッチサイズ）が設定可能
