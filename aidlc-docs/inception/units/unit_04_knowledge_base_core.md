# Unit 4: ナレッジベース・コア

> **対応 Epic**: Epic 4 — ナレッジベース機能（コア部分）
> **対応ストーリー**: US-4.1〜US-4.11

---

## ユーザーストーリーと受け入れ基準

### US-4.1 [Must] 内部リンク `[[]]` 作成

個人開発者として、`[[ファイル名]]` 記法で他のノートへの内部リンクを作成したい。なぜなら、関連するノート同士を結びつけてナレッジのネットワークを構築したいからだ。

- [ ] `[[` を入力するとリンク作成モードに入る
- [ ] `[[ファイル名]]` がLive Previewでリンクとして視覚的に区別される
- [ ] 存在しないファイルへのリンクが色やスタイルで区別される

### US-4.2 [Should] 内部リンクのオートコンプリート

個人開発者として、内部リンクを入力する際にオートコンプリートで既存ファイル名の候補が表示されてほしい。なぜなら、正確なファイル名を覚えていなくても素早くリンクを作成したいからだ。

- [ ] `[[` の後にテキストを入力すると候補リストが表示される
- [ ] 候補はファジーマッチで絞り込まれる
- [ ] 候補を選択すると `[[ファイル名]]` が補完される

### US-4.3 [Must] 内部リンクからの遷移

個人開発者として、内部リンクをクリックしてリンク先のノートに直接遷移したい。なぜなら、関連情報にシームレスにアクセスしたいからだ。

- [ ] 内部リンクをクリック（またはCtrl+クリック）するとリンク先ファイルが開く
- [ ] リンク先が存在しない場合、新規ファイル作成の確認が表示される

### US-4.4 [Should] バックリンク表示

個人開発者として、現在のノートに対するバックリンク（他のノートからのリンク）を一覧表示したい。なぜなら、どのノートが現在のノートを参照しているかを把握し、情報の関係性を理解したいからだ。

- [ ] サイドパネルまたはエディタ下部にバックリンク一覧が表示される
- [ ] 各バックリンクにリンク元ファイル名と該当箇所の前後テキストが表示される
- [ ] バックリンクをクリックするとリンク元ファイルの該当箇所に遷移する

### US-4.5 [Could] 未リンク言及の検出

個人開発者として、テキスト上でリンクされていないが、ノート名と一致する言及（未リンク言及）も検出・表示してほしい。なぜなら、明示的にリンクを貼っていない関連ノートを発見したいからだ。

- [ ] バックリンクパネルに「未リンク言及」セクションが表示される
- [ ] ノート名と一致するテキストがVault内から検出・一覧表示される
- [ ] 未リンク言及をクリックして内部リンクに変換できる

### US-4.6 [Should] タグ管理

個人開発者として、`#タグ` 記法でノートにタグを付与し、タグ一覧を閲覧・フィルタリングしたい。なぜなら、フォルダ構造とは別の軸でノートを分類・検索したいからだ。

- [ ] `#タグ名` がエディタ上でタグとして視覚的に区別される
- [ ] Vault内のすべてのタグを一覧表示するパネルがある
- [ ] タグをクリックするとそのタグを持つノートの一覧が表示される
- [ ] ネストされたタグ（`#parent/child`）がサポートされる

### US-4.7 [Must] 全文検索

個人開発者として、プロジェクト内の全ファイルを対象にキーワードで全文検索したい。なぜなら、どのファイルに目的の情報が書かれているかを素早く見つけたいからだ。

- [ ] 検索パネルでキーワードを入力すると.gitignore適用後の全ファイルを対象に検索が実行される
- [ ] 検索結果にファイル名と一致箇所のプレビューが表示される
- [ ] 検索結果をクリックすると該当ファイルの該当箇所に遷移する
- [ ] 検索が高速（1秒以内、p95）に完了する（ベースライン: M1 Mac、Vault 10,000ファイル/1GB規模、ウォーム状態。コールドスタート時は初回インデックス構築後に同等性能）

### US-4.8 [Should] Graph View（グラフ表示）

個人開発者として、Graph Viewでノート間のリンク関係をネットワークグラフとして可視化したい。なぜなら、ナレッジ全体の構造や隠れた関連性を直感的に把握したいからだ。

- [ ] ノートがノード、内部リンクがエッジとしてグラフ描画される
- [ ] ノードをドラッグして配置を調整できる
- [ ] ノードをクリックすると対応するノートが開く
- [ ] グラフの表示がUIをブロックしない（バックグラウンド計算）

### US-4.9 [Could] Graph Viewフィルタリング

個人開発者として、Graph Viewをタグやフォルダで絞り込みたい。なぜなら、特定のトピックに関連するノート群だけを集中的に確認したいからだ。

- [ ] タグでノードをフィルタリングできる
- [ ] フォルダでノードをフィルタリングできる
- [ ] フィルタ適用後にグラフが再描画される

### US-4.10 [Could] ローカルグラフ

個人開発者として、特定のノートを起点としたローカルグラフ（2-3ホップ先まで）を表示したい。なぜなら、大量のノートがある中で、今関連しているノート群のみを効率的に確認したいからだ。

- [ ] 現在開いているノートを起点としたローカルグラフを表示できる
- [ ] 表示する深さ（ホップ数）を設定できる（デフォルト: 2）
- [ ] ローカルグラフ内のノードをクリックすると該当ノートが開く

### US-4.11 [Should] AIからリンク構造取得

AIエージェントとして、ノート間のリンク構造（内部リンク・バックリンク・タグ）を参照したい。なぜなら、プロジェクトのナレッジ構造を理解した上で、適切なコンテキストでドキュメントを生成・編集したいからだ。

- [ ] API経由で指定ファイルの内部リンク一覧を取得できる
- [ ] API経由で指定ファイルのバックリンク一覧を取得できる
- [ ] API経由でVault内の全タグとそれに紐づくファイル一覧を取得できる
