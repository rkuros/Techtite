# Unit 8: システム信頼性・アンビエントエージェント・セッションログ

> **対応 Epic**: Epic 6 — AIエージェント管理・ターミナル（システム信頼性部分）+ Epic 7 — エージェントセッションログ
> **対応ストーリー**: US-6.10〜US-6.12, US-7.1〜US-7.5

---

## ユーザーストーリーと受け入れ基準

### システム信頼性・アンビエントエージェント（Epic 6）

#### US-6.10 [Must] システムレベル操作キャプチャ（エージェント非依存）

個人開発者として、すべてのファイル操作・Git操作・コマンド実行がエージェントに依存せずシステムレベルで自動記録されてほしい。なぜなら、エージェントが記録を忘れてもデータが失われないことを保証したいからだ。

- [ ] ファイルシステムWatcherにより、Vault内のすべてのファイル操作（作成・編集・削除・移動）がリアルタイムで自動記録される
- [ ] Git操作（commit, push, pull, merge, branch）がフック経由で自動記録される
- [ ] ターミナルで実行されたコマンドとその出力が自動記録される
- [ ] 記録はエージェントの動作に一切依存しない（システムプロセスとして常時稼働）
- [ ] 記録データは構造化フォーマット（JSON/SQLite）で保存され、後続処理の素材となる
- [ ] 生ログはローカル専用ストレージに保存され、Git同期対象から除外される（自動で.gitignoreに追加）
- [ ] ログ内の秘匿情報（APIキー、パスワード、トークン等）がパターンマッチで自動マスキングされる（正規表現ベース、既知のAPIキー形式・URL埋め込みトークン等を即座に検出）
- [ ] （Phase 2）ローカルLLMによるコンテキスト解析で未知の秘匿情報を検出・マスキングする。**生ログは外部LLM/外部サービスに一切送信しない（オンデバイス限定）**
- [ ] マスキング対象パターンをカスタム定義できる（正規表現ルール）
- [ ] 生ログの閲覧には明示的な確認操作が必要（ワンクリックで秘匿情報が見えない設計）

#### US-6.11 [Must] アンビエントエージェント（監視・検証・是正）

個人開発者として、アンビエントエージェント（マネージャー）が全作業エージェントを監視し、必須タスクの実行漏れを検出・通知してほしい。なぜなら、エージェントがセッションログの記録やGit同期を忘れた場合に気づけるようにしたいからだ。

- [ ] アンビエントエージェントがバックグラウンドで常時稼働する
- [ ] 各作業エージェントの必須タスク（ログ記録、コミット、同期等）の完了を定期チェックする
- [ ] 必須タスクが未完了の場合、人間にアラート通知する
- [ ] エージェントの稼働状態・タスク完了率がダッシュボードに表示される
- [ ] チェック項目（何を必須タスクとするか）を設定で定義できる
- [ ] リトライ上限を設定可能（無限ループ防止）
- [ ] （Phase 2）未完了タスクの自動再実行指示（自動是正）

#### US-6.12 [Should] アンビエントエージェント（ログ粒度管理・コンテンツ統括）

個人開発者として、アンビエントエージェントがセッションログの粒度を管理し、適切な記録と人間向けコンテンツへの変換を統括してほしい。なぜなら、エージェントの生の操作ログは膨大すぎるので、目的に応じた適切な粒度で整理・公開してほしいからだ。

- [ ] ログ粒度を設定で選択できる（詳細: 全操作記録 / 標準: 主要操作+判断 / コンパクト: マイルストーンのみ）
- [ ] システムレベルの生ログ（US-6.10）からアンビエントエージェントが構造化セッションログ（Epic 7）を自動生成する
- [ ] 日単位のデイリーサマリーを自動生成し、各エージェントの成果を統合する
- [ ] セッションログの品質（記載漏れ、不整合）を自動検証する
- [ ] ブログ/SNSへの変換パイプライン（Epic 8, 9）の実行スケジュールを管理し、未変換のログがあれば自動でパイプラインを起動する
- [ ] コンテンツ変換の品質（読みやすさ、情報の網羅性）を公開前に自動チェックする

---

### エージェントセッションログ（Epic 7）

#### US-7.1 [Must] セッション操作の自動記録

AIエージェントとして、セッション（作業期間）の操作内容を構造化ログとして自動記録したい。なぜなら、個人開発者が後から作業内容を参照・レビューできるようにしたいからだ。

- [ ] エージェントのセッション開始時にログファイルが自動作成される
- [ ] 編集ファイル、コミット内容、実行コマンド、作業の意図・判断がログに含まれる
- [ ] ログはマークダウン形式で保存される（人間が読みやすい）
- [ ] セッション終了時にログが自動的にクローズされる

#### US-7.2 [Must] デイリーログ（日単位サマリー）自動生成

AIエージェントとして、日単位でその日の全セッションの作業サマリーを自動生成したい。なぜなら、１日の作業全体を俯瞰できるデイリーログを提供したいからだ。

- [ ] 日付ベースのデイリーログファイルが自動生成される
- [ ] その日に稼働した全エージェントのセッションが統合される
- [ ] 主要な変更内容・作成ファイル・コミット等のサマリーが含まれる

#### US-7.3 [Must] セッションログ一覧・閲覧

個人開発者として、セッションログを日付・エージェント別に一覧表示して閲覧したい。なぜなら、過去にどのエージェントがいつ何をしたかを振り返りたいからだ。

- [ ] セッションログの一覧が日付順で表示される
- [ ] エージェント名でフィルタリングできる
- [ ] ログを選択するとマークダウンとしてエディタで閲覧できる

#### US-7.4 [Should] ログ内リンクからファイル・コミット遷移

個人開発者として、セッションログ内から参照されるファイルやコミットに直接遷移したい。なぜなら、ログに記載された変更内容の詳細を確認したいからだ。

- [ ] ログ内のファイルパスがクリック可能なリンクとして表示される
- [ ] リンクをクリックすると該当ファイルがエディタで開かれる
- [ ] コミットハッシュからGit差分表示に遷移できる

#### US-7.5 [Should] ログ保存先・フォーマットカスタマイズ

個人開発者として、セッションログの保存先フォルダとファイル名フォーマットをカスタマイズしたい。なぜなら、プロジェクトの管理方法に合わせて整理したいからだ。

- [ ] 設定画面でログの保存先フォルダを指定できる
- [ ] ファイル名フォーマット（日付・エージェント名等）を設定できる
